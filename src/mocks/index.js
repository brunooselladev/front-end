const deepClone = (value) => JSON.parse(JSON.stringify(value));

export const wait = (ms = 300) =>
  new Promise((resolve) => {
    setTimeout(resolve, ms);
  });

const roleHome = {
  admin: '/admin/recursero/calendario-semanal',
  agente: '/agente/asistencia',
  efector: '/efector/pacientes',
  referente: '/referente/mis-acompanados',
  usmya: '/usmya/mi-perfil',
};

const nowDate = new Date();
const isoDay = (dayOffset) => {
  const d = new Date(nowDate);
  d.setDate(d.getDate() + dayOffset);
  return d.toISOString().slice(0, 10);
};

const initialState = {
  authUsers: [
    { email: 'admin@test.com', password: 'Admin1234', userId: 1 },
    { email: 'agente@test.com', password: 'Agente1234', userId: 2 },
    { email: 'efector@test.com', password: 'Efector1234', userId: 3 },
    { email: 'referente@test.com', password: 'Referente1234', userId: 4 },
    { email: 'usmya@test.com', password: 'Usmya1234', userId: 5 },
  ],
  users: [
    {
      id: 1,
      email: 'admin@test.com',
      role: 'admin',
      isVerified: 'aprobado',
      nombre: 'Carlos Admin',
      dni: null,
      fechaNacimiento: null,
      telefono: null,
      direccionResidencia: null,
      alias: null,
      generoAutoPercibido: null,
      estadoCivil: null,
      obraSocial: null,
      geolocalizacion: null,
      creadoPor: null,
      requiereAprobacion: false,
      idEspacio: null,
      tipoProfesional: null,
      esEfector: false,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 2,
      email: 'agente@test.com',
      role: 'agente',
      isVerified: 'aprobado',
      nombre: 'Paula Agente',
      dni: 28000111,
      fechaNacimiento: '1990-10-10',
      telefono: '3511234567',
      direccionResidencia: 'Barrio Centro',
      alias: null,
      generoAutoPercibido: 'femenino',
      estadoCivil: 'soltera',
      obraSocial: null,
      geolocalizacion: '-31.42,-64.18',
      creadoPor: null,
      requiereAprobacion: false,
      idEspacio: 1,
      tipoProfesional: 'Agente comunitaria',
      esEfector: false,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 3,
      email: 'efector@test.com',
      role: 'efector',
      isVerified: 'aprobado',
      nombre: 'Diego Efector',
      dni: 29000999,
      fechaNacimiento: '1988-07-07',
      telefono: '3519876543',
      direccionResidencia: 'Barrio Norte',
      alias: null,
      generoAutoPercibido: 'masculino',
      estadoCivil: 'casado',
      obraSocial: null,
      geolocalizacion: '-31.41,-64.19',
      creadoPor: null,
      requiereAprobacion: false,
      idEspacio: 2,
      tipoProfesional: 'Médico',
      esEfector: true,
      esETratante: true,
      registroConUsmya: false,
    },
    {
      id: 4,
      email: 'referente@test.com',
      role: 'referente',
      isVerified: 'aprobado',
      nombre: 'Ana Referente',
      dni: 30111999,
      fechaNacimiento: '1986-06-06',
      telefono: '3511112233',
      direccionResidencia: 'Barrio Sur',
      alias: null,
      generoAutoPercibido: 'femenino',
      estadoCivil: 'casada',
      obraSocial: null,
      geolocalizacion: '-31.43,-64.20',
      creadoPor: null,
      requiereAprobacion: false,
      idEspacio: null,
      tipoProfesional: null,
      esEfector: false,
      esETratante: false,
      registroConUsmya: true,
    },
    {
      id: 5,
      email: 'usmya@test.com',
      role: 'usmya',
      isVerified: 'aprobado',
      nombre: 'Luis Usmya',
      dni: 42000111,
      fechaNacimiento: '2006-03-11',
      telefono: '3519988776',
      direccionResidencia: 'Barrio Oeste',
      alias: 'Lucho',
      generoAutoPercibido: 'masculino',
      estadoCivil: 'soltero',
      obraSocial: 'APROSS',
      geolocalizacion: '-31.44,-64.17',
      creadoPor: 2,
      requiereAprobacion: true,
      idEspacio: null,
      tipoProfesional: null,
      esEfector: false,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 6,
      email: 'sofia.usmya@test.com',
      role: 'usmya',
      isVerified: 'aprobado',
      nombre: 'Sofia Paz',
      dni: 43000222,
      fechaNacimiento: '2005-09-15',
      telefono: '3512233445',
      direccionResidencia: 'Villa El Libertador',
      alias: 'Sofi',
      generoAutoPercibido: 'femenino',
      estadoCivil: 'soltera',
      obraSocial: 'PAMI',
      geolocalizacion: '-31.45,-64.17',
      creadoPor: 3,
      requiereAprobacion: true,
      idEspacio: null,
      tipoProfesional: null,
      esEfector: false,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 7,
      email: 'tomi.usmya@test.com',
      role: 'usmya',
      isVerified: 'pendiente',
      nombre: 'Tomas Ruiz',
      dni: 44000333,
      fechaNacimiento: '2004-01-01',
      telefono: '3515566778',
      direccionResidencia: 'Arguello',
      alias: 'Tomi',
      generoAutoPercibido: 'masculino',
      estadoCivil: 'soltero',
      obraSocial: null,
      geolocalizacion: '',
      creadoPor: 4,
      requiereAprobacion: true,
      idEspacio: null,
      tipoProfesional: null,
      esEfector: false,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 8,
      email: 'agente.nuevo@test.com',
      role: 'agente',
      isVerified: 'pendiente',
      nombre: 'Melina Gómez',
      dni: 33000444,
      fechaNacimiento: '1992-01-20',
      telefono: '3511000200',
      direccionResidencia: 'San Vicente',
      alias: null,
      generoAutoPercibido: 'femenino',
      estadoCivil: 'soltera',
      obraSocial: null,
      geolocalizacion: '',
      creadoPor: null,
      requiereAprobacion: true,
      idEspacio: 1,
      tipoProfesional: 'Agente comunitaria',
      esEfector: false,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 9,
      email: 'efector.nuevo@test.com',
      role: 'efector',
      isVerified: 'pendiente',
      nombre: 'Juan Prueba',
      dni: 30000555,
      fechaNacimiento: '1987-12-10',
      telefono: '3512000300',
      direccionResidencia: 'Alta Córdoba',
      alias: null,
      generoAutoPercibido: 'masculino',
      estadoCivil: 'casado',
      obraSocial: null,
      geolocalizacion: '',
      creadoPor: null,
      requiereAprobacion: true,
      idEspacio: 3,
      tipoProfesional: 'Psicólogo',
      esEfector: true,
      esETratante: false,
      registroConUsmya: false,
    },
    {
      id: 10,
      email: 'referente.nuevo@test.com',
      role: 'referente',
      isVerified: 'pendiente',
      nombre: 'Sandra López',
      dni: 28000666,
      fechaNacimiento: '1994-02-14',
      telefono: '3513000400',
      direccionResidencia: 'General Paz',
      alias: null,
      generoAutoPercibido: 'femenino',
      estadoCivil: 'soltera',
      obraSocial: null,
      geolocalizacion: '',
      creadoPor: null,
      requiereAprobacion: true,
      idEspacio: null,
      tipoProfesional: null,
      esEfector: false,
      esETratante: false,
      registroConUsmya: true,
    },
  ],
  espacios: [
    {
      id: 1,
      nombre: 'Las Aldeas',
      telefono: '3511111111',
      tipoOrganizacion: 'comunitario',
      direccion: 'Av. Principal 100',
      barrio: 'Arguello',
      encargado: 'María López',
      poblacionVinculada: ['niños', 'adolescentes', 'familias'],
      diasHorarios: 'Lunes a Viernes 9 a 18',
      actividadEspacio: [],
      coordenadas: { lat: -31.41, lng: -64.18 },
      cuentaConInternet: true,
      cuentaConDispositivo: true,
    },
    {
      id: 2,
      nombre: 'Centro de Salud Norte',
      telefono: '3512222222',
      tipoOrganizacion: 'estatal',
      direccion: 'Calle 2 456',
      barrio: 'Centro',
      encargado: 'Dr. Ramos',
      poblacionVinculada: ['adultos', 'mayores', 'familias'],
      diasHorarios: 'Lunes a Viernes 8 a 16',
      actividadEspacio: [],
      coordenadas: { lat: -31.43, lng: -64.19 },
      cuentaConInternet: true,
      cuentaConDispositivo: true,
    },
    {
      id: 3,
      nombre: 'Merendero El Maná',
      telefono: '3513333333',
      tipoOrganizacion: 'merendero',
      direccion: 'Calle 3 789',
      barrio: 'Villa Libertador',
      encargado: 'Norma Díaz',
      poblacionVinculada: ['niños', 'adolescentes'],
      diasHorarios: 'Martes a Sábados 10 a 14',
      actividadEspacio: [],
      coordenadas: { lat: -31.44, lng: -64.16 },
      cuentaConInternet: false,
      cuentaConDispositivo: true,
    },
    {
      id: 4,
      nombre: 'Parroquia del Barrio',
      telefono: '3514444444',
      tipoOrganizacion: 'religiosa',
      direccion: 'Calle 4 222',
      barrio: 'Villa Cornú',
      encargado: 'Padre Carlos',
      poblacionVinculada: ['adultos', 'familias'],
      diasHorarios: 'Lunes a Sábado 9 a 19',
      actividadEspacio: [],
      coordenadas: { lat: -31.46, lng: -64.15 },
      cuentaConInternet: true,
      cuentaConDispositivo: false,
    },
  ],
  actividades: [
    {
      id: 1,
      nombre: 'Taller de arte',
      descripcion: 'Arte y expresión para adolescentes',
      dia: isoDay(2),
      hora: '14:00',
      horaFin: '16:00',
      responsable: 'Paula Agente',
      espacioId: 1,
      lugar: 'Salón 1',
      esFija: true,
      isVerified: true,
    },
    {
      id: 2,
      nombre: 'Grupo terapéutico',
      descripcion: 'Encuentro de acompañamiento',
      dia: isoDay(1),
      hora: '10:00',
      horaFin: '11:30',
      responsable: 'Diego Efector',
      espacioId: 2,
      lugar: 'Sala 3',
      esFija: true,
      isVerified: true,
    },
    {
      id: 3,
      nombre: 'Huerta comunitaria',
      descripcion: 'Trabajo en grupo y hábitos saludables',
      dia: isoDay(3),
      hora: '09:00',
      horaFin: '11:00',
      responsable: 'Melina Gómez',
      espacioId: 1,
      lugar: 'Patio',
      esFija: false,
      isVerified: false,
    },
    {
      id: 4,
      nombre: 'Ronda de familias',
      descripcion: 'Espacio de escucha para referentes',
      dia: isoDay(4),
      hora: '18:00',
      horaFin: '19:00',
      responsable: 'Ana Referente',
      espacioId: 4,
      lugar: 'Salón principal',
      esFija: false,
      isVerified: false,
    },
  ],
  asistencias: [
    { id: 1, idActividad: 1, idUser: 5, estado: 'presente', observacion: 'Participó activamente' },
    { id: 2, idActividad: 1, idUser: 6, estado: 'ausente', observacion: 'No pudo asistir' },
    { id: 3, idActividad: 2, idUser: 5, estado: 'presente', observacion: 'Asistencia completa' },
    { id: 4, idActividad: 2, idUser: 6, estado: 'presente', observacion: 'Buen compromiso' },
  ],
  chats: [
    { id: 1, idUsmya: 5, tipo: 'general' },
    { id: 2, idUsmya: 5, tipo: 'tratante' },
    { id: 3, idUsmya: 6, tipo: 'general' },
  ],
  integrantesChat: [
    { id: 1, idChat: 1, idUser: 2 },
    { id: 2, idChat: 1, idUser: 3 },
    { id: 3, idChat: 1, idUser: 4 },
    { id: 4, idChat: 2, idUser: 3 },
    { id: 5, idChat: 2, idUser: 4 },
    { id: 6, idChat: 3, idUser: 2 },
    { id: 7, idChat: 3, idUser: 3 },
  ],
  mensajes: [
    { id: 1, descripcion: 'Hola equipo', idEmisor: 2, idChat: 1, fecha: isoDay(-1), hora: '09:30' },
    { id: 2, descripcion: 'Buen día', idEmisor: 3, idChat: 1, fecha: isoDay(-1), hora: '09:34' },
    { id: 3, descripcion: 'Quedamos atentos', idEmisor: 4, idChat: 1, fecha: isoDay(-1), hora: '09:36' },
    { id: 4, descripcion: 'Revisión médica realizada', idEmisor: 3, idChat: 2, fecha: isoDay(0), hora: '11:15' },
  ],
  referenteUsmya: [
    { id: 1, idUsmya: 5, idReferente: 4 },
    { id: 2, idUsmya: 6, idReferente: 4 },
  ],
  efectorUsmya: [
    { id: 1, idEfector: 3, idUsmya: 5 },
    { id: 2, idEfector: 3, idUsmya: 6 },
  ],
  notasTrayectoria: [
    {
      id: 1,
      idActor: 3,
      idUsmya: 5,
      titulo: 'Evaluación inicial',
      observacion: 'Buena adherencia al tratamiento',
      fecha: `${isoDay(-5)}T00:00:00.000Z`,
      hora: '10:00',
    },
    {
      id: 2,
      idActor: 4,
      idUsmya: 5,
      titulo: 'Seguimiento social',
      observacion: 'Se reforzó red de apoyo familiar',
      fecha: `${isoDay(-2)}T00:00:00.000Z`,
      hora: '15:20',
    },
  ],
  tags: [
    { id: 1, nombre: 'Grupal', descripcion: 'Actividad grupal' },
    { id: 2, nombre: 'Salud mental', descripcion: 'Acompañamiento emocional' },
    { id: 3, nombre: 'Educación', descripcion: 'Apoyo escolar y hábitos' },
    { id: 4, nombre: 'Comunidad', descripcion: 'Actividades territoriales' },
  ],
};

let state = deepClone(initialState);

const nextId = (collection) => {
  if (!collection.length) return 1;
  return Math.max(...collection.map((item) => Number(item.id) || 0)) + 1;
};

export const mockStore = {
  reset() {
    state = deepClone(initialState);
    return deepClone(state);
  },
  getState() {
    return deepClone(state);
  },
  getHomePathByRole(role) {
    return roleHome[role] || '/login';
  },
  read(collectionName) {
    return deepClone(state[collectionName] || []);
  },
  findById(collectionName, id) {
    const collection = state[collectionName] || [];
    return deepClone(collection.find((item) => Number(item.id) === Number(id)) || null);
  },
  insert(collectionName, payload) {
    if (!state[collectionName]) state[collectionName] = [];
    const entity = { id: nextId(state[collectionName]), ...payload };
    state[collectionName].push(entity);
    return deepClone(entity);
  },
  update(collectionName, id, patch) {
    const collection = state[collectionName] || [];
    const index = collection.findIndex((item) => Number(item.id) === Number(id));
    if (index < 0) return null;
    collection[index] = { ...collection[index], ...patch };
    return deepClone(collection[index]);
  },
  remove(collectionName, id) {
    const collection = state[collectionName] || [];
    const index = collection.findIndex((item) => Number(item.id) === Number(id));
    if (index < 0) return false;
    collection.splice(index, 1);
    return true;
  },
};

export const mockMenuByRole = {
  admin: [
    {
      label: 'Recursero',
      icon: '/assets/recursero.svg',
      url: '/recursero',
      subsections: [
        { label: 'Calendario semanal', icon: '/assets/recursero.svg', url: '/admin/recursero/calendario-semanal' },
        { label: 'Prestaciones', icon: '/assets/recursero.svg', url: '/admin/recursero/prestaciones' },
      ],
    },
    {
      label: 'Notificaciones',
      icon: '/assets/notificaciones.svg',
      url: '/admin',
      subsections: [
        { label: 'Usuarios', icon: '/assets/notificaciones.svg', url: '/admin/notificaciones' },
        { label: 'Actividades', icon: '/assets/notificaciones.svg', url: '/admin/notificaciones-actividades' },
      ],
    },
    { label: 'Espacios', icon: '/assets/espacios.svg', url: '/admin/espacios' },
  ],
  agente: [
    { label: 'Asistencias', icon: '/assets/asistencias.svg', url: '/agente/asistencia' },
    { label: 'Nuevo usuario', icon: '/assets/registro-paciente.svg', url: '/agente/registro-usmya' },
    { label: 'Sala de chat', icon: '/assets/chat.svg', url: '/agente/chat-general' },
    { label: 'Perfil espacio', icon: '/assets/perfil-espacio.svg', url: '/agente/mi-institucion' },
  ],
  efector: [
    { label: 'Mis pacientes', icon: '/assets/mis-acompanados.svg', url: '/efector/pacientes' },
    {
      label: 'Sala de chat',
      icon: '/assets/chat.svg',
      url: '/efector',
      subsections: [
        { label: 'Sala general', icon: '/assets/chat.svg', url: '/efector/chat-general' },
        { label: 'Sala e.tratante', icon: '/assets/chat.svg', url: '/efector/chat-tratante' },
      ],
    },
    { label: 'Mi institucion', icon: '/assets/perfil-espacio.svg', url: '/efector/mi-institucion' },
  ],
  referente: [
    { label: 'Mis acompanados', icon: '/assets/mis-acompanados.svg', url: '/referente/mis-acompanados' },
    { label: 'Sala de chat', icon: '/assets/chat.svg', url: '/referente/chat-general' },
  ],
  usmya: [
    { label: 'Mi Trayectoria', icon: '/assets/trayectoria.svg', url: '/usmya/mi-trayectoria' },
    { label: 'Mi perfil', icon: '/assets/mi-perfil.svg', url: '/usmya/mi-perfil' },
  ],
};


