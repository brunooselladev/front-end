<div class="app-page">
  <app-navbar></app-navbar>

  <div class="app-page__body">
    <app-sidebar></app-sidebar>

    <div class="app-page__content">
      <div class="page-header">
        <h1 class="page-header__title">Espacios</h1>
        <app-button
          label="Nuevo Espacio"
          (clicked)="abrirFormModal()"
          variant="primary"
          size="medium">
        </app-button>
      </div>

      <main class="page-main" style="width: 100%;">
        <app-table
          [columns]="tableColumns"
          [data]="getTableData()"
          [filters]="tableFilters"
          [showFilter]="showFilter"
          (onView)="onTableView($event)"
          (onEdit)="onTableEdit($event)"
          (onDelete)="onTableDelete($event)"
          class="w-full">
        </app-table>
      </main>

      @if (isFormModalOpen) {
        <app-side-menu
          [isOpen]="isFormModalOpen"
          [title]="espacioSeleccionado ? 'Editar Espacio' : 'Nuevo Espacio'"
          (closeEvent)="onCloseForm()">
          <app-space-form
            [espacio]="espacioSeleccionado"
            (cerrar)="onCloseForm()"
            (guardado)="onFormularioGuardado()">
          </app-space-form>
        </app-side-menu>
      }

      @if (isDetailsModalOpen) {
        <app-side-menu
          [isOpen]="isDetailsModalOpen"
          [title]="'Detalle de Espacio'"
          (closeEvent)="onCloseDetailsModal()">
          <div class="font-sans max-h-[80vh]" *ngIf="espacioSeleccionado">
      
      <!-- Información General -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3 pb-2 border-b border-gray-200">Información General</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Nombre:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.nombre }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Tipo de Organización:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.tipoOrganizacion }}</span>
          </div>
        </div>
      </div>

      <!-- Información de Contacto -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3 pb-2 border-b border-gray-200">Información de Contacto</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Teléfono:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.telefono }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Dirección:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.direccion }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Barrio:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.barrio }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Encargado:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.encargado }}</span>
          </div>
        </div>
      </div>

      <!-- Población Vinculada -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3 pb-2 border-b border-gray-200">Población Vinculada</h3>
        <div class="flex flex-wrap gap-2">
          <span 
            *ngFor="let poblacion of espacioSeleccionado.poblacionVinculada" 
            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            {{ getPoblacionLabel(poblacion) }}
          </span>
        </div>
      </div>

      <!-- Horarios y Actividades -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3 pb-2 border-b border-gray-200">Horarios y Actividades</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Días y Horarios:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.diasHorarios }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Actividades Principales:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.actividadesPrincipales }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Actividades Secundarias:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.actividadesSecundarias }}</span>
          </div>
        </div>
      </div>

      <!-- Coordenadas -->
      <!-- <div class="mb-6" style="margin-bottom: 30px;">
        <h3 class="text-lg font-semibold text-gray-900 mb-3 pb-2 border-b border-gray-200">Ubicación</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Latitud:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.coordenadas?.lat }}</span>
          </div>
          <div class="flex justify-between items-start py-2">
            <span class="text-sm font-medium text-gray-600 min-w-0 flex-shrink-0 mr-4">Longitud:</span>
            <span class="text-sm text-gray-900 text-right flex-1">{{ espacioSeleccionado.coordenadas?.lng }}</span>
          </div>
        </div>
      </div> -->
    </div>
        </app-side-menu>
      }

      @if (showDeleteConfirmation) {
        <app-modal-confirmation
          [visible]="showDeleteConfirmation"
          [type]="'danger'"
          [message]="'¿Está seguro que desea eliminar el espacio \'' + espacioSeleccionado?.nombre + '\'? Esta acción no se puede deshacer.'"
          (confirm)="confirmarEliminacion()"
          (cancel)="cancelarEliminacion()">
        </app-modal-confirmation>
      }
    </div>
  </div>
</div>